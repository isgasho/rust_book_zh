文档
===

文档在软件工程中是非常重要的，有时候比代码本身还要重要。我认为文档工具是现代编程语言的标配，既然 Rust 声称自己是现代（modern）的编程语言当然也提供了文档工具。

##rustdoc

Rust 的安装包里面包含了一个叫做 `rustdoc` 的工具，可以用它来生成文档。`cargo doc` 命令其实也是调用的 `rustdoc`。

文档来源有两种，一种是你的源代码注释，一种是单独的 markdown 文件。

##给你的代码写文档

按照一定的格式给 rust 代码写注释就可以方便地用 `rustdoc` 来自动生成文档:

    /// 创建一个 `Rc<T>` 类型
    ///
    /// # Example
    ///
    /// ```
    /// use std::rc::Rc;
    ///
    /// let five = Rc::new(5);
    /// ```
    pub fn new(value: T) -> Rc<T> {
        // ...
    }

注意，用于生成文档的注释应该是三个斜杠 `///` 开头，注释里面的内容是 markdown 格式的。

一开始写文档的时候经常会犯一些错误，比如：

    /// The `Option` type. See [the module level documentation](../) for more.
    enum Option<T> {
        None, /// No value
        Some(T), /// Some value `T`
    }

这里把文档注释写在了一行代码的最后，调用 rustdoc 生成文档的时候会报错：

    hello.rs:4:1: 4:2 error: expected ident, found `}`
    hello.rs:4 }
               ^
这是因为文档注释作用于注释后面 `///` 的语句，而 `/// Some value `T`` 之后没有语句了，所以报错。

##编写文档注释

我们再看前面这个例子：

    /// 创建一个 `Rc<T>` 类型

文档注释的第一行应该是关于下面这段代码作用的一个概述。就一句话简单的概括就行。
概括性的描述之后，如果有必要详细的说明一下，就另起一段：

    ///
    /// 在这里描述一下各个参数的意义，具体的使用方法，注意事项等等
    /// ... ...
    ///



###特殊段落

rustdoc 定义了一些特殊段落，它们以 # 符号开头

    /// # Examples

这个段落的你可以写上两三个例子来描述一下用法

    /// # Panics

不可恢复的错误在 Rust 里通常是由 panic 来表示的，如果的函数里可能会发生这样的错误，你可以在这个段落里说明一下。

    /// # Failtures

如果你的方法或者函数返回一个 Result<T,E>，在这里描述一下什么情况下会返回 Err(E) 就会很有用。

    /// # Safety

如果你的代码是危险的（unsafe）你应该在这个段落里告诉使用者注意事项。

###在文档中标示代码

你可以用三点符号来标示注释中的代码：

    /// ```
    /// println!("Hello, world");
    /// ```

如果要写 Rust 以外的代码，可以加一个符号：

    /// ```c
    /// printf("Hello, world\n");
    /// ```

它可以高亮任意的语言，如果是纯文本就用 `text`。
值得注意的是，这里你一定要选择正确的符号，如果你明明是 c++ 代码却选了 c 的符号，rustdoc 是会报错的。

